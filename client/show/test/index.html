<html>
<head>
<title>Cross Browser Test</title>
<script type="text/javascript" src="../js/util.js"></script>
</head>
<body>
<canvas id="glscreen"></canvas>
<script type="text/javascript">
  var gl;
  var canvas;

  window.onload = init;

  function init() {
    var root = './'
    loadTextResource(root + 'shader.vs.glsl', function (vsErr, vsText) {
      if (vsErr) {
        alert('Fatal error getting vertex shader (see console)');
        console.error(vsErr);
      } else {
        loadTextResource(root + 'shader.fs.glsl', function (fsErr, fsText) {
          canvas        = document.getElementById('glscreen');
          gl            = getGL("#glscreen");
          canvas.width  = 256;
          canvas.height = 256;

          gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);


          var buffer = gl.createBuffer();
          gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
          gl.bufferData(
          gl.ARRAY_BUFFER,
            new Float32Array([
              -1.0, -1.0,
               1.0, -1.0,
              -1.0,  1.0,
              -1.0,  1.0,
               1.0, -1.0,
               1.0,  1.0]),
            gl.STATIC_DRAW
          );

          var vertexShader = gl.createShader(gl.VERTEX_SHADER);
          gl.shaderSource(vertexShader, fsText);
          gl.compileShader(vertexShader);

          var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);
          gl.shaderSource(fragmentShader, vsText);
          gl.compileShader(fragmentShader);

          program = gl.createProgram();
          gl.attachShader(program, vertexShader);
          gl.attachShader(program, fragmentShader);
          gl.linkProgram(program);
          gl.useProgram(program);

          function render() {
            gl.clearColor(1.0, 0.0, 0.0, 1.0);
            gl.clear(gl.COLOR_BUFFER_BIT);
            positionLocation = gl.getAttribLocation(program, "a_position");
            gl.enableVertexAttribArray(positionLocation);
            gl.vertexAttribPointer(positionLocation, 2, gl.FLOAT, false, 0, 0);
            gl.drawArrays(gl.TRIANGLES, 0, 6);

            window.requestAnimationFrame(render, canvas);
          }

          render();
        })
      }
    });
  }


</script>

</body>